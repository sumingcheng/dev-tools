user nginx;
worker_processes auto;

events {
    worker_connections 1024;
}

http {
    include /etc/nginx/mime.types;
    default_type application/octet-stream;

    # 定义上游代理服务器
    upstream proxy_server {
        server 127.0.0.1:7890;
    }

    # 哔哩哔哩相关域名映射
    map $http_host $proxy_host {
        ~^.*\.bilibili\.com$ $http_host;
        ~^.*\.bilivideo\.com$ $http_host;
        ~^.*\.biliapi\.net$ $http_host;
        ~^.*\.hdslb\.com$ $http_host;
        default $http_host;
    }

       server {
           listen 8080;
           server_name _;
           location / {
               proxy_pass https://bilibili.com;
               proxy_set_header Host $host;
               proxy_set_header X-Real-IP $remote_addr;
               proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
               proxy_http_version 1.1;
               proxy_set_header Upgrade $http_upgrade;
               proxy_set_header Connection "upgrade";
               proxy_read_timeout 90;
               proxy_redirect off;
               # 设置代理服务器
               proxy_set_header Proxy "";
               proxy_http_version 1.1;
               # 配置 HTTP 代理
               proxy_set_header Proxy "http://127.0.0.1:7890";
           }
       }
}